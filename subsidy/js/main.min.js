ldc.register("who",[],function(){var t,e;return t={target:{}},e=new ldView({root:"[ld-scope=who]",handler:{avatar:function(e){var n;return n=e.node,n.style.backgroundImage="url("+siteroot+"assets/img/cand/img_leaderboard_"+t.num+".png)"},name:function(e){var n;return n=e.node,n.textContent=t.target.name},list:{list:function(){return t.target.list},handle:function(t){var e,n,r,o,i,a;return e=t.node,n=t.data,r=ld$.find(e,"[ld=mark]",0),o=ld$.find(e,"[ld=title]",0),i=ld$.find(e,"[ld=amount]",0),o.textContent=n.title,a=1e6*Math.round(n.amount/1e6),i.textContent=numconvert.a2c(a,{partial:!0}),r.style.backgroundImage="url("+siteroot+"assets/img/party/ic_"+n.party+".png)"}}}}),ldc.action({show:function(n,r){return(t.cache?Promise.resolve(t.cache):ld$.fetch(siteroot+"assets/data/who.json",{method:"GET"},{type:"json"})).then(function(o){var i;if(t.cache=o,i=o.filter(function(t){return t.name===n})[0])return t.target=i,t.num=r,e.render(),lda.ldcvmgr.toggle("who")})}})}),ldc.register("interview",[],function(){var t,e;return t={target:{}},e=new ldView({root:"[ld-scope=interview]",handler:{avatar:function(e){return e.node.setAttribute("data-name",siteroot+"assets/img/cand/interview/talk_portrait_"+t.target.name+".png")},name:function(e){var n;return n=e.node,n.textContent=t.target.name},title:function(e){var n;return n=e.node,n.textContent=t.target.title},brief:function(e){var n;return n=e.node,n.textContent=t.target.brief},video:function(e){return e.node.setAttribute("src",t.target.video)||"about:blank"},content:function(e){var n;return n=e.node,n.innerHTML=(t.target.html||"").replace(/\n/g,"")}}}),ldc.action({video:function(){return lda.ldcvmgr.get("video").then(function(){return iframe.setAttribute("src","about:blank")})},show:function(n){return(t.cache?Promise.resolve(t.cache):ld$.fetch(siteroot+"assets/data/interview.json",{method:"GET"},{type:"json"})).then(function(r){var o,i;if(t.cache=r,o=r.filter(function(t){return t.name===n})[0])return t.target=o,e.render(),lda.ldcvmgr.toggle("interview"),(i=ld$.find(document,".ldcvmgr[data-name=interview]",0))?setTimeout(function(){return i.scrollTop=0},100):void 0})}})}),ldc.register("history",[],function(){var t,e,n,r,o;return t={idx:0},e=datasrc.history,n=e.map(function(t){return t.year-1911}),r=function(r){var i,a,u;if(null==r&&(r=1),t.idx=(i=t.idx+r)>0?i:0,a=t.idx===n.length,o.get("read").classList.toggle("d-none",a),o.get("end").classList.toggle("d-none",!a),!a)return(u=o.get("illustration")).setAttribute("src",siteroot+"assets/img/history/history_img_"+n[t.idx]+".png"),u.classList.add("d-none"),debounce(10).then(function(){return o.get("illustration").classList.remove("d-none")}),o.get("year").innerHTML="民國<br>"+(e[t.idx].year-1911)+"年"+(t.idx===n.length-1?"<br>迄今":""),o.get("desc").textContent=e[t.idx].desc+""},ldc.action({show:function(){return t.idx=0,r(0),lda.ldcvmgr.get("history").then(function(){return t.idx=0})}}),o=new ldView({root:"[ld-scope=history]",action:{click:{prev:function(t){return t.node,r(-1)},next:function(t){return t.node,r(1)}}},handler:{illustration:function(t){t.node},year:function(){},desc:function(){}}})}),ldc.register("main",["ldcvmgr","history","interview","who","parallax","nav"],function(){var t,e,n;return t={vote:{}},t.vote={target:"蔡英文",cand:{}},e=function(){var t,e;if((t=n.getAll("section").map(function(t){return[t.getAttribute("data-value"),t.getBoundingClientRect().top]}).filter(function(t){return t[1]<=window.innerHeight})).sort(function(t,e){return e[1]-t[1]}),e=t[0])return n.getAll("hint").map(function(t){return t.classList.toggle("active",t.getAttribute("data-value")===e[0])})},ld$.fetch("https://pts.tellstory.io/e/vote",{method:"GET"},{type:"json"}).then(function(e){var r,o;return e.map(function(e){var n,r;return((n=t.vote.cand)[r=e.name]||(n[r]={})).count=isNaN(+e.count)?"???":e.count}),t.vote.max=Math.max.apply(null,function(){var e,n=[];for(r in e=t.vote.cand)o=e[r],n.push(o.count);return n}()),n.render(["vote-count-total","vote-count","vote-money"])}),t.obs=new IntersectionObserver(e,{root:null}),n=new ldView({root:document,action:{click:{vote:function(e){var r,o;return r=e.node,o=r.getAttribute("data-value"),t.vote.target={song:"宋楚瑜",fish:"韓國瑜",tsai:"蔡英文"}[o],t.vote.key=o,n.getAll("vote-ani").map(function(t){return t.classList.toggle("d-none",!0)}),n.get("vote-result").classList.remove("d-none"),scrollto("#vote-result",500,0),ld$.fetch("https://pts.tellstory.io/e/vote",{method:"POST"},{type:"json",json:{v:t.vote.target}}).catch(function(){}),setTimeout(function(){return n.getAll("vote-ani").map(function(t){return t.classList.toggle("d-none",!1)})},500),n.render()},hint:function(t){var e,r,o;if(e=t.node,r=e.getAttribute("data-value"),o=n.getAll("section").filter(function(t){return t.getAttribute("data-value")===r})[0])return scrollto(o,500)}}},init:{url:function(t){var e;return e=t.node,e.value=window.location.href},section:function(e){var n;return n=e.node,t.obs.observe(n)},copylink:function(t){var e;return e=t.node,new ClipboardJS(e).on("success",function(){return e.classList.add("tip-on"),setTimeout(function(){return e.classList.remove("tip-on")},2e3)})}},handler:{"vote-cand":function(e){var n;return(n=e.node).classList.toggle("d-none",n.getAttribute("data-value")===t.vote.target)},"vote-target-portrait":function(e){var n;if(n=e.node,t.vote.key)return n.style.backgroundImage="url("+siteroot+"assets/img/cand/top/img_candidate_"+t.vote.key+".png)"},"vote-target-count":function(e){var n,r,o;return n=e.node,n.textContent=((r=t.vote.cand)[o=t.vote.target]||(r[o]={})).count||0},"vote-target-name":function(e){var n;return n=e.node,n.textContent=t.vote.target},"vote-count":function(e){var n,r,o,i;return n=e.node,r=(o=t.vote.cand)[i=n.getAttribute("data-value")]||(o[i]={}),n.textContent=null!=r.count?r.count:"..."},"vote-money":function(e){var n,r,o,i,a;return n=e.node,r=(o=t.vote.cand)[i=n.getAttribute("data-value")||t.vote.target]||(o[i]={}),n.textContent=null!=r.count?r.count>=t.vote.max/3?(a=30*r.count,numconvert.a2c(a,{partial:["億","萬"]})):0:"..."},"vote-count-total":function(e){var n,r,o,i;return n=e.node,r=function(){var e,n=[];for(o in e=t.vote.cand)i=e[o],n.push([o,i]);return n}().map(function(t){return t[1].count}).reduce(function(t,e){return t+e},0),n.textContent=isNaN(r)?"...":r}}}),ld$.find(document,".sticky").map(function(){return stickybits(".sticky")})}),ldc.app("main");